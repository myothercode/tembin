<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.base.database.customtrading.mapper.FeedBackReportMapper">
  <resultMap id="BaseResultMap" type="com.base.domains.querypojos.FeedBackReportQuery">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
      <result column="returnType" jdbcType="VARCHAR" property="returnType" />
      <result column="tjNumber" jdbcType="VARCHAR" property="tjNumber" />
  </resultMap>
    <resultMap id="BaseResultMap1" type="com.base.domains.querypojos.FeedBackQuery">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        <id column="id" jdbcType="BIGINT" property="id" />
        <result column="CommentingUser" jdbcType="VARCHAR" property="commentinguser" />
        <result column="CommentingUserScore" jdbcType="BIGINT" property="commentinguserscore" />
        <result column="CommentTime" jdbcType="TIMESTAMP" property="commenttime" />
        <result column="CommentType" jdbcType="VARCHAR" property="commenttype" />
        <result column="ItemID" jdbcType="VARCHAR" property="itemid" />
        <result column="Role" jdbcType="VARCHAR" property="role" />
        <result column="FeedbackID" jdbcType="VARCHAR" property="feedbackid" />
        <result column="TransactionID" jdbcType="VARCHAR" property="transactionid" />
        <result column="OrderLineItemID" jdbcType="VARCHAR" property="orderlineitemid" />
        <result column="ItemTitle" jdbcType="VARCHAR" property="itemtitle" />
        <result column="ItemPrice" jdbcType="DOUBLE" property="itemprice" />
        <result column="currencyID" jdbcType="VARCHAR" property="currencyid" />
        <result column="autoMessageFlag" jdbcType="INTEGER" property="automessageflag" />
        <result column="sentTime" jdbcType="TIMESTAMP" property="senttime" />
        <result column="autoMessage_id" jdbcType="BIGINT" property="automessageId" />
        <result column="create_time" jdbcType="TIMESTAMP" property="createTime" />
        <result column="uuid" jdbcType="VARCHAR" property="uuid" />
        <result column="user_id" jdbcType="VARCHAR" property="userId" />
        <result column="ebay_account" jdbcType="VARCHAR" property="ebayAccount" />
        <result column="updateTime" jdbcType="TIMESTAMP" property="updatetime" />
    </resultMap>


    <select id="selectFeedBackReportList" resultMap="BaseResultMap" parameterType="map">
        select feed.CommentType returnType,count(*) tjNumber from trading_feedbackdetail feed  where 1=1
        <if test="datetype==1||datetype==2">
            and DATE_FORMAT(feed.CommentTime, '%Y-%m-%d') = #{datestr}
        </if>
        <if test="datetype==3||datetype==4">
            and DATE_FORMAT(feed.CommentTime, '%Y-%m-%d') >= #{startDate} and  #{endDate}>=DATE_FORMAT(feed.CommentTime, '%Y-%m-%d')
        </if>
        <if test="datetype==5||datetype==6">
            and DATE_FORMAT(feed.CommentTime, '%Y-%m') = #{datestr}
        </if>
        <if test="userid!=null">
            and feed.ebay_account in(select eb.ebay_name from usercontroller_user_ebay us,
            usercontroller_ebay_account eb
            where us.ebay_id = eb.id and us.user_id=#{userid})
        </if>
         group by feed.CommentType order by feed.CommentType desc
    </select>
    <select id="selectFeedBackDetailByAutoMessageFlag" resultMap="BaseResultMap1" parameterType="map">
        select feed.* from trading_feedbackdetail feed  where 1=1
        and feed.Role="Seller" and feed.autoMessageFlag =0
        <if test="sentTime!=null">
            and feed.sentTime &lt; #{sentTime}
        </if>
        <if test="ebays!=null">
            and feed.CommentType in
            <foreach collection="types" item="type" index="index" open="(" separator="," close=")">
                #{types}
            </foreach>
        </if>
    </select>
</mapper>