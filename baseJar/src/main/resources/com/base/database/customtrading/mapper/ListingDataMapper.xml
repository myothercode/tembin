<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.base.database.customtrading.mapper.ListingDataMapper">
    <resultMap id="BaseResultMap" type="com.base.domains.querypojos.ListingDataQuery">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        <id column="id" jdbcType="BIGINT" property="id" />
        <result column="item_id" jdbcType="VARCHAR" property="itemId" />
        <result column="pic_url" jdbcType="VARCHAR" property="picUrl" />
        <result column="sku" jdbcType="VARCHAR" property="sku" />
        <result column="ebay_account" jdbcType="VARCHAR" property="ebayAccount" />
        <result column="site" jdbcType="VARCHAR" property="site" />
        <result column="listing_type" jdbcType="VARCHAR" property="listingType" />
        <result column="price" jdbcType="BIGINT" property="price" />
        <result column="shipping_price" jdbcType="BIGINT" property="shippingPrice" />
        <result column="Quantity" jdbcType="BIGINT" property="quantity" />
        <result column="QuantitySold" jdbcType="BIGINT" property="quantitysold" />
        <result column="ListingDuration" jdbcType="VARCHAR" property="listingduration" />
        <result column="StartTime" jdbcType="TIMESTAMP" property="starttime" />
        <result column="EndTime" jdbcType="TIMESTAMP" property="endtime" />
        <result column="do_rate" jdbcType="BIGINT" property="doRate" />
        <result column="create_date" jdbcType="TIMESTAMP" property="createDate" />
        <result column="update_date" jdbcType="TIMESTAMP" property="updateDate" />
        <result column="title" jdbcType="VARCHAR" property="title" />
        <result column="create_user" jdbcType="BIGINT" property="createUser" />
        <result column="folder_id" jdbcType="VARCHAR" property="folderId" />
        <result column="remark" jdbcType="VARCHAR" property="remark" />
        <result column="currencyId" property="currencyId" jdbcType="VARCHAR" />
        <result column="siteName" property="siteName" jdbcType="VARCHAR" />
        <result column="docTitle" property="docTitle" jdbcType="VARCHAR" />
        <result column="docId" property="docId" jdbcType="VARCHAR" />
    </resultMap>
    <select id="selectByExample" resultMap="BaseResultMap" parameterType="map">
        select tion.*,dic.value1 currencyId,dic.name siteName,doc.item_name docTitle,doc.id docId from trading_listing_data tion inner join (select acc.* from usercontroller_ebay_account acc,usercontroller_user_ebay dev where acc.id=dev.ebay_id and dev.user_id=#{userid}
        ) ebayaccount on tion.ebay_account=ebayaccount.ebay_account left join (select tra.* from trading_data_dictionary tra where tra.type='site') dic on tion.site=dic.value left join trading_item doc on tion.item_id=doc.item_id
        where 1=1 and tion.is_flag='0'
        <if test="folderid==null">
            and tion.folder_id is null
        </if>
        <if test="folderid!=null">
            and tion.folder_id = #{folderid}
        </if>
        <!--<if test="userid!=null">
            and tion.create_user = #{userid}
        </if>-->
        <if test="flag==1">
            and tion.QuantitySold > 0
        </if>
        <if test="flag==2">
            and tion.QuantitySold = 0
        </if>
        <if test="county!=null">
            and dic.id = #{county}
        </if>
        <if test="listingtype!=null">
            and tion.listing_type = #{listingtype}
        </if>
        <if test="ebayaccount!=null">
            and tion.ebay_account = #{ebayaccount}
        </if>
        <if test="selectType!=null and selectType=='docname'">
            and doc.item_name like CONCAT(CONCAT('%', #{selectValue, jdbcType=VARCHAR}),'%')
        </if>
        <if test="selectType!=null and selectType=='sku'">
            and tion.sku like CONCAT(CONCAT('%', #{selectValue, jdbcType=VARCHAR}),'%')
        </if>
        <if test="selectType!=null and selectType=='title'">
            and tion.title like CONCAT(CONCAT('%', #{selectValue, jdbcType=VARCHAR}),'%')
        </if>
        <if test="selectType!=null and selectType!='docname' and selectType!='sku' and selectType!='title'">
            and tion.${selectType}  = #{selectValue}
        </if>
        order by ${descStr} ${desStr}
    </select>
    <select id="selectListDateByExample" resultMap="BaseResultMap" parameterType="map">
        select listing.* from trading_listing_data listing where 1=1
        <if test="content!=null">
           and listing.sku like "%"#{content}"%"
       </if>
       <if test="userId!=null">
           and listing.create_user= #{userId}
       </if>
    </select>
</mapper>