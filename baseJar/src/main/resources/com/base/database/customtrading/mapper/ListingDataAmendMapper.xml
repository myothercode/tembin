<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.base.database.customtrading.mapper.ListingDataAmendMapper">
    <resultMap id="BaseResultMap" type="com.base.domains.querypojos.ListingDataAmendQuery">
        <id column="id" jdbcType="BIGINT" property="id" />
        <result column="item_id" jdbcType="VARCHAR" property="itemId" />
        <result column="pic_url" jdbcType="VARCHAR" property="picUrl" />
        <result column="sku" jdbcType="VARCHAR" property="sku" />
        <result column="ebay_account" jdbcType="VARCHAR" property="ebayAccount" />
        <result column="site" jdbcType="VARCHAR" property="site" />
        <result column="listing_type" jdbcType="VARCHAR" property="listingType" />
        <result column="price" jdbcType="BIGINT" property="price" />
        <result column="shipping_price" jdbcType="BIGINT" property="shippingPrice" />
        <result column="Quantity" jdbcType="BIGINT" property="quantity" />
        <result column="QuantitySold" jdbcType="BIGINT" property="quantitysold" />
        <result column="ListingDuration" jdbcType="VARCHAR" property="listingduration" />
        <result column="StartTime" jdbcType="TIMESTAMP" property="starttime" />
        <result column="EndTime" jdbcType="TIMESTAMP" property="endtime" />
        <result column="do_rate" jdbcType="BIGINT" property="doRate" />
        <result column="create_date" jdbcType="TIMESTAMP" property="createDate" />
        <result column="update_date" jdbcType="TIMESTAMP" property="updateDate" />
        <result column="title" jdbcType="VARCHAR" property="title" />
        <result column="create_user" jdbcType="BIGINT" property="createUser" />

        <result column="amend_type" property="amendType" jdbcType="VARCHAR" />
        <result column="amend_user" property="amendUser" jdbcType="BIGINT" />
        <result column="amend_time" property="amendTime" jdbcType="TIMESTAMP" />
        <result column="endisflag" property="endisflag" jdbcType="VARCHAR" />
        <result column="endid" property="endid" jdbcType="VARCHAR" />
    </resultMap>
    <resultMap id="ResultMapWithBLOBs" type="com.base.domains.querypojos.ListingDataAmendQuery" extends="BaseResultMap" >
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        <result column="content" property="content" jdbcType="LONGVARCHAR" />
    </resultMap>
    <select id="selectByExample" resultMap="BaseResultMap" parameterType="map">
        select enditem.*,groa.endid endid from (
        select tion.*,amend.amend_type,amend.item,amend.id amendid,amend.create_user amend_user,amend.create_time amend_time,amend.is_flag endisflag,amend.content from trading_listing_data tion,trading_listing_amend amend
        where tion.id=amend.parent_id
        <if test="parentId!=null">
            and amend.parent_id = #{parentId}
        </if>
        <if test="userid!=null">
            and amend.create_user = #{userid}
        </if>
        <if test="flag==1">
            and tion.QuantitySold > 0
        </if>
        <if test="flag==2">
            and tion.QuantitySold = 0
        </if>
        <if test="county!=null">
            and tion.site = #{county}
        </if>
        <if test="listingtype!=null">
            and tion.listing_type = #{listingtype}
        </if>
        <if test="ebayaccount!=null">
            and tion.ebay_account = #{ebayaccount}
        </if>
        <if test="selectType!=null">
            and tion.${selectType} = #{selectValue}
        </if>
        <if test="amendType!=null">
            and amend.amend_type = #{amendType}
        </if>
        <if test="amendFlag!=null">
            and amend.is_flag = #{amendFlag}
        </if>
        ) enditem LEFT JOIN (select max(id) endid from trading_listing_amend ss group by ss.parent_id,ss.amend_type,ss.content ) groa on enditem.amendid = groa.endid
        ORDER BY enditem.amendid desc
    </select>
</mapper>